!function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./server/server.ts")}({"./server/lib/player.ts":
/*!******************************!*\
  !*** ./server/lib/player.ts ***!
  \******************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, "default", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o["default"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.PlayerChanged = exports.GetPlayer = exports.GetPlayerSrc = exports.GetPlayerIdentifiers = void 0;\r\nconst sql = __importStar(__webpack_require__(/*! ./sql */ "./server/lib/sql.ts"));\r\nconst players = new sql.Cache("SELECT * FROM players WHERE discord = ?");\r\nfunction GetPlayerIdentifiers(src) {\r\n    let discord = "";\r\n    let steam = "";\r\n    for (let i = 0; i < GetNumPlayerIdentifiers(src); i++) {\r\n        const identifier = GetPlayerIdentifier(src, i);\r\n        if (identifier.startsWith(\'discord\')) {\r\n            discord = identifier;\r\n        }\r\n        if (identifier.startsWith(\'steam\')) {\r\n            steam = identifier;\r\n        }\r\n    }\r\n    return { discord: discord, steam: steam };\r\n}\r\nexports.GetPlayerIdentifiers = GetPlayerIdentifiers;\r\nfunction GetPlayerSrc(src) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const discord = GetPlayerIdentifiers(src).discord;\r\n        if (discord.length > 0) {\r\n            return yield GetPlayer(discord);\r\n        }\r\n    });\r\n}\r\nexports.GetPlayerSrc = GetPlayerSrc;\r\nfunction GetPlayer(discord) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return yield players.get(discord);\r\n    });\r\n}\r\nexports.GetPlayer = GetPlayer;\r\nfunction PlayerChanged(discord) {\r\n    players.changed(discord);\r\n}\r\nexports.PlayerChanged = PlayerChanged;\r\n\n\n//# sourceURL=webpack:///./server/lib/player.ts?')},"./server/lib/sql.ts":
/*!***************************!*\
  !*** ./server/lib/sql.ts ***!
  \***************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.Cache = exports.scalarSync = exports.scalar = exports.executeSync = exports.execute = void 0;\r\nconst timeout = 500;\r\nfunction execute(query, parameters, callback) {\r\n    global.exports.ghmattimysql.execute(query, parameters, callback);\r\n}\r\nexports.execute = execute;\r\nfunction executeSync(query, parameters) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return Promise.race([\r\n            new Promise((_resolve, reject) => { const wait = setTimeout(() => { clearTimeout(wait); reject("timeout"); }, timeout); }),\r\n            new Promise((resolve) => {\r\n                global.exports.ghmattimysql.execute(query, parameters, (result) => { resolve(result); });\r\n            })\r\n        ]);\r\n    });\r\n}\r\nexports.executeSync = executeSync;\r\nfunction scalar(query, parameters, callback) {\r\n    global.exports.ghmattimysql.scalar(query, parameters, callback);\r\n}\r\nexports.scalar = scalar;\r\nfunction scalarSync(query, parameters) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return Promise.race([\r\n            new Promise((_resolve, reject) => { const wait = setTimeout(() => { clearTimeout(wait); reject("timeout"); }, timeout); }),\r\n            new Promise((resolve) => {\r\n                global.exports.ghmattimysql.scalar(query, parameters, (result) => { resolve(result); });\r\n            })\r\n        ]);\r\n    });\r\n}\r\nexports.scalarSync = scalarSync;\r\nfunction isEmpty(obj) {\r\n    return Object.keys(obj).length === 0;\r\n}\r\nclass Cache {\r\n    constructor(selectQuery) {\r\n        this.cache = {};\r\n        this.query = selectQuery;\r\n    }\r\n    get(key) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.cache[key]) {\r\n                const value = yield executeSync(this.query, [key]);\r\n                if (!isEmpty(value)) {\r\n                    this.cache[key] = value;\r\n                }\r\n            }\r\n            return this.cache[key];\r\n        });\r\n    }\r\n    changed(key) {\r\n        this.cache[key] = null;\r\n    }\r\n}\r\nexports.Cache = Cache;\r\n\n\n//# sourceURL=webpack:///./server/lib/sql.ts?')},"./server/server.ts":
/*!**************************!*\
  !*** ./server/server.ts ***!
  \**************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, "default", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o["default"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nconst players = __importStar(__webpack_require__(/*! ./lib/player */ "./server/lib/player.ts"));\r\nconst sql = __importStar(__webpack_require__(/*! ./lib/sql */ "./server/lib/sql.ts"));\r\nonNet(\'ft-core:tpm\', () => {\r\n    console.log(`TPM by ${source}`);\r\n});\r\nonNet(\'playerConnecting\', () => {\r\n    insertOrUpdatePlayer(source);\r\n});\r\nfunction insertOrUpdatePlayer(src) {\r\n    const identifiers = players.GetPlayerIdentifiers(src);\r\n    sql.execute("INSERT INTO `players` (`steam`,`discord`) VALUES (?, ?) ON DUPLICATE KEY UPDATE `steam` = ?", [identifiers.steam, identifiers.discord, identifiers.steam], () => {\r\n        players.PlayerChanged(identifiers.discord);\r\n    });\r\n}\r\nRegisterCommand(\'sql\', (src) => {\r\n    const identifiers = players.GetPlayerIdentifiers(src);\r\n    sql.execute("INSERT INTO `players` (`steam`,`discord`) VALUES (?, ?) ON DUPLICATE KEY UPDATE `steam` = ?", [identifiers.steam, identifiers.discord, identifiers.steam], () => {\r\n        players.PlayerChanged(identifiers.discord);\r\n    });\r\n}, false);\r\nRegisterCommand(\'sql2\', (src) => __awaiter(void 0, void 0, void 0, function* () {\r\n    console.log(JSON.stringify(yield players.GetPlayerSrc(src)));\r\n}), false);\r\n\n\n//# sourceURL=webpack:///./server/server.ts?')}});