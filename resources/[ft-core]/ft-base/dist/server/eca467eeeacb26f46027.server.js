(()=>{"use strict";var e={469:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,c){function a(e){try{s(r.next(e))}catch(e){c(e)}}function o(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterChanged=t.GetCharacter=t.GetCharacters=void 0;const i=n(243),c=new i.Cache("characters","id"),a=new i.ArrayCache("characters","player_discord");t.GetCharacters=function(e){return r(this,void 0,void 0,(function*(){return yield a.get(e)}))},t.GetCharacter=function(e){return r(this,void 0,void 0,(function*(){return yield c.get(e)}))},t.CharacterChanged=function(e){c.changed(a[e].id),a.changed(e)}},708:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,c){function a(e){try{s(r.next(e))}catch(e){c(e)}}function o(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerChanged=t.GetPlayer=t.GetPlayerSrc=void 0;const i=n(243),c=n(693),a=new i.Cache("players","discord");function o(e){return r(this,void 0,void 0,(function*(){return yield a.get(e)}))}t.GetPlayerSrc=function(e){return r(this,void 0,void 0,(function*(){const t=c.GetPlayerIdentifiers(e).discord;if(t.length>0)return yield o(t)}))},t.GetPlayer=o,t.PlayerChanged=function(e){a.changed(e)}},693:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetPlayerIdentifiers=void 0,t.GetPlayerIdentifiers=function(e){let t="",n="";for(let r=0;r<GetNumPlayerIdentifiers(e);r++){const i=GetPlayerIdentifier(e,r);i.startsWith("discord")&&(t=i),i.startsWith("steam")&&(n=i)}return{discord:t,steam:n}}},243:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,c){function a(e){try{s(r.next(e))}catch(e){c(e)}}function o(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}s((r=r.apply(e,t||[])).next())}))};function r(e,t){return n(this,void 0,void 0,(function*(){return i(new Promise((n=>{global.exports.ghmattimysql.execute(e,t,(e=>{n(e)}))})),500)}))}function i(e,t){return n(this,void 0,void 0,(function*(){return Promise.race([new Promise(((e,n)=>{const r=setTimeout((()=>{clearTimeout(r),n("timeout")}),t)})),e])}))}function c(e){return 0===Object.keys(e).length}Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayCache=t.Cache=t.scalarSync=t.scalar=t.executeSync=t.execute=void 0,t.execute=function(e,t,n){global.exports.ghmattimysql.execute(e,t,n)},t.executeSync=r,t.scalar=function(e,t,n){global.exports.ghmattimysql.scalar(e,t,n)},t.scalarSync=function(e,t){return n(this,void 0,void 0,(function*(){return i(new Promise((n=>{global.exports.ghmattimysql.scalar(e,t,(e=>{n(e)}))})),500)}))},t.Cache=class{constructor(e,t){this.cache={},this.multipleCache={},this.query=`SELECT * FROM ${e} WHERE ${t} = ?`}get(e){return n(this,void 0,void 0,(function*(){if(!this.cache[e]){const t=yield r(this.query,[e]);c(t)||Array.isArray(t)?Array.isArray(t)&&(this.cache[e]=t[0]):this.cache[e]=t}return this.cache[e]}))}getMultiple(e){return n(this,void 0,void 0,(function*(){if(!this.cache[e]){const t=yield r(this.query,[e]);Array.isArray(t)&&(this.multipleCache[e]=t)}return this.multipleCache[e]}))}changed(e){this.cache[e]=null}},t.ArrayCache=class{constructor(e,t){this.cache={},this.query=`SELECT * FROM ${e} WHERE ${t} = ?`}get(e){return n(this,void 0,void 0,(function*(){if(!this.cache[e]){const t=yield r(this.query,[e]);c(t)||(this.cache[e]=t)}return this.cache[e]}))}changed(e){this.cache[e]=null}}},21:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=n(693),o=c(n(708)),s=c(n(469)),u=c(n(243));onNet("ft-core:tpm",(()=>{console.log(`TPM by ${source}`)})),onNet("playerConnecting",(()=>{!function(e){const t=a.GetPlayerIdentifiers(e);u.execute("INSERT INTO `players` (`steam`,`discord`) VALUES (?, ?) ON DUPLICATE KEY UPDATE `steam` = ?",[t.steam,t.discord,t.steam],(()=>{o.PlayerChanged(t.discord)}))}(source)})),RegisterCommand("sql",(e=>{const t=a.GetPlayerIdentifiers(e);u.execute("INSERT INTO `players` (`steam`,`discord`) VALUES (?, ?) ON DUPLICATE KEY UPDATE `steam` = ?",[t.steam,t.discord,t.steam],(()=>{o.PlayerChanged(t.discord)}))}),!1),RegisterCommand("chars",(e=>{const t=a.GetPlayerIdentifiers(e).discord;s.GetCharacters(t).then((e=>{setImmediate((()=>console.log(JSON.stringify(e))))}))}),!1),RegisterCommand("char",((e,t)=>{s.GetCharacter(t[0]).then((e=>{setImmediate((()=>console.log(JSON.stringify(e))))}))}),!1)}},t={};!function n(r){var i=t[r];if(void 0!==i)return i.exports;var c=t[r]={exports:{}};return e[r].call(c.exports,c,c.exports,n),c.exports}(21)})();